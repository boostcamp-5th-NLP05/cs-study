# 입출력장치

# 08-1 장치 컨트롤러와 장치 드라이버

## 장치 컨트롤러
### 입출력장치를 다루기 까다로운 이유
  1. 입출력 장치의 종류가 너무 많음
  2. CPU, 메모리의 데이터 전송률은 높고 그에 비해 입출력장치의 데이터 전송률은 낮다.
    
    - 전송률: 데이터를 얼마나 빨리 교환할 수 있는지 나타내는 지표
### 장치 컨트롤러 (입출력 제어기, 입출력 모듈)
  - 입출력장치는 컴퓨터와 직접적으로 연결되지 않고, 장치 컨트롤러라는 하드웨어를 통해 연결
  - 장치 컨트롤러가 컴퓨터와 입출력장치 간 매개체가 되어 '전송률의 차이로 CPU와 메모리, 입출력장치간 통신이 어려움'의 한계를 극복
### 장치 컨트롤러의 역할
  - CPU와 입출력장치 간 통신 중개
  - 오류 검출
  - 데이터 버퍼링 
    - 버퍼링: 전송률이 높은 장치와 낮은 장치 사이 주고 받는 데이터를 임시 저장 공간인 버퍼에 저장해 전송률을 비슷하게 맞추는 방법

-> 장치 컨트롤러는 전송률이 높은 CPU와 전송률이 낮은 입출력 장치간 전송률 차이를 데이터 버퍼링으로 완화함
### 장치 컨트롤러의 내부 구조
  - 데이터 레지스터 : CPU와 입출력장치 사이 주고받는 데이터가 담기는 레지스터
  - 상태 레지스터 : 입출력장치의 상태 정보를 저장하는 레지스터
  - 제어 레지스터 : 입출력장치가 수행할 작업에 대한 제어 정보와 명령을 저장하는 레지스터

## 장치 드라이버
  - 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램
  - 운영체제에서 기본으로 제공하는 장치 드라이버라면 따로 설치가 필요 없으며 장치 제작자가 따로 드라이버를 제공하는 경우, 해당 드라이버를 따로 설치해야 장치를 사용할 수 있음

# 08-2 다양한 입출력 방법
## 프로그램 입출력
  - 프로그램 속 명령어로 입출력장치를 제어하는 방법
  - CPU는 입출력장치에 연결된 장치 컨트롤러를 통해 입출력 작업을 수행
### 폴링: CPU가 입출력장치의 상태가 어떤지, 처리할 데이터가 있는지 주기적으로 확인하는 방식
  - CPU가 주기적으로 확인하기 때문에 장치컨트롤러에 의한 입출력장치 제어 방식보다 CPU에 부담이 큼
### 메모리 맵 입출력 vs 고립형 입출력
![image](https://github.com/boostcamp-5th-NLP05/cs-study/assets/96599427/2f115426-7b73-4d9e-999e-7e5fd6e43990)

## 인터럽트 기반 입출력
  - 입출력장치의 작업 시작, 작업 종료 등 인터럽트 발생을 통해 입출력을 하는 방식
  - 입출력장치에 대한 인터럽트는 장치 컨트롤러에서 발생
### PIC : 우선순위가 높은 인터럽트 순으로 다중 인터럽트를 처리
  - 프로그래머블 인터럽트 컨트롤러 : 여러 장치 컨트롤러에 연결돼 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청의 우선순위를 판별하여 우선순위의  하드웨어 인터럽트가 무엇인지 전달
  - **PIC 다중 인터럽트 처리 과정**
    - PIC가 장치 컨트롤러에서 **인터럽트 요청 신호**들을 받아들임
    - PIC는 인터럽트 우선순위를 판단, CPU에 처리해야 할 **인터럽트 요청 신호**를 보냄
    - CPU는 PIC에 **인터럽트 확인 신호**를 보냄
    - PIC는 데이터 버스를 통해 CPU에 **인터럽트 벡터**를 보냄
    - CPU는 인터럽트 벡터를 통해 인터럽트 요청을 한 하드웨어를 알고, 해당 장치의 **인터럽트 서비스 루틴**을 실행
### NMI: 인터럽트 비트가 비활성화 되어도 무시할 수 없는 인터럽트
## DMA 입출력
  - 입출력장치 인터럽트 처리시에 이동하는 데이터가 CPU를 거치지 않고 메모리에서 데이터를 바로 접근하는 입출력 방식
  - CPU 부담을 최소화 하기 위함
  - DMA 컨트롤러(시스템 버스에 연결)라는 하드웨어를 이용해 DMA 입출력
### DMA 입출력 과정
  - CPU가 DMA 컨트롤러에 입출력장치 주소, 수행할 연산, 읽고 쓸 메모리 주소 등 입출력 정보를 명령
  - DMA 컨트롤러는 장치 컨트롤러와 직접 상호작용하여 입출력 작업 수행 (이 때, DMA 컨트롤러가 직접 메모리에 접근하여 정보를 읽거나 쓸 수 있음)
  - 입출력 작업이 끝났을 때 DMA 컨트롤러가 CPU에 인터럽트를 보내 작업이 끝났음을 알림
### DMA 입출력 특징
  - CPU는 입출력 명령 이후 입출력 작업(데이터 송수신)에 관여하지 않음
  - 장점 : 결과 인터럽트만 받으면 되기 때문에 부담이 줄어듬
  - 단점 : DMA 컨트롤러는 CPU와 시스템 버스를 공용 자원으로 사용하여 동시에 이용할 수 없음 (사이클 스틸링 : DMA의 시스템 버스 이용)
### 입출력 버스 : DMA 컨트롤러와 장치 컨트롤러를 연결하는 버스
  - CPU, 메모리, DMA 컨트롤러, 장치컨트롤러가 모두 같은 버스를 공유함
  - DMA에서 메모리 접근할때마다 시스템 버스를 두번 이용하여 CPU가 시스템 버스를 이용하는데 병목을 발생
-> DMA 컨트롤러와 장치 컨트롤러 간 데이터 전송 시에 입출력 버스를 이용하여 시스템 버스의 사용 빈도를 줄임
  - PCI 버스, PCIe 버스가 있음
### 입출력 프로세서 (입출력 채널)
  - 입출력 명령어를 직접 인출, 해석, 실행까지하는 입출력 전용 CPU라고 할 수 있음
  - 최신 입출력장치 내부에 별도의 입출력 프로세서가 포함될 수 있음
  - 입출력 채널이 있는 경우 CPU가 입출력 명령어를 처리하지 않고 명령어를 수행을 지시함
