# Chapter 10 프로세스와 스레드

## 10-1 프로세스 개요

- **프로세스**
  - 실행 중인 프로그램. 
    - 보조기억장치 속 데이터 덩어리 -> 메모리에 적재하고 실행(프로세스 생성)
    - 윈도우 작업 관리자, 유닉스 ps
  - **포그라운드** 프로세스
  - **백그라운드** 프로세스
    - 사용자와 상호작용하지 않는 백그라운드 프로세스: 윈도우 서비스, 유닉스 데몬
- **프로세스 제어 블록(PCB)**: 프로세스를 식별하기 위해 필요한 정보 저장
  - **프로세스 ID(PID)**: 프로세스 고유 번호
  - 레지스터 값
  - 프로세스 상태: 입출력장치를 사용하기 위해 기다리고 있는 상태, CPU를 사용하기 위해 기다리고 있는 상태, CPU를 이용하고 있는 상태 등
  - CPU 스케쥴링 정보: 언제, 어떤 순서로 CPU를 할당받을지
  - 메모리 관리 정보: 프로세스가 어느 주소에 저장되어 있는지. 테이블 정보(14장)
  - 사용한 파일과 입출력장치 목록
- **문맥 교환(context switching)**
  - 기존 프로세스 문맥을 PCB에 백업, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구해서 새로운 프로세스 실행
  - **문맥(context)**: 프로그램 카운터, 레지스터 값 등 하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보. PCB에 기록.
  - 문맥을 백업하고 복구하는 과정에서 오버로드 발생. 너무 자주 일어나는 것도 안 좋음
- 프로세스의 메모리 영역
    |크기 변화|이름|설명|
    |---|---|---|
    |정적 할당 영역|**코드 영역/텍스트 영역**|- 기계어로 이루어진 명령어 저장<br>- 쓰기가 금지된 읽기 전용(read-only) 공간|
    ||**데이터 영역**|- 전역 변수 등 프로그램이 실행되는 동안 유지할 데이터 저장|
    |동적 할당 영역|**힙 영역**|- 프로그래머가 직접 할당할 수 있는 저장 공간<br>- **메모리 누수(memory leak)**: 메모리 공간을 반환하지 않아 메모리가 낭비되는 문제|
    |(힙: 낮은&rarr;높은 주소.<br>스택: 높은&rarr;낮은 주소)|**스택 영역**|- 매개 변수, 지역 변수 등 데이터를 일시적으로 저장|

## 10-2 프로세스 상태와 계층 구조

- 프로세스 상태
  - **생성 상태(new)**: 막 메모리에 적재되어 PCB를 할당받은 상태
  - **준비 상태(ready)**: CPU 할당을 기다리고 있는 상태
    - 디스패치(dispatch): 준비 &rarr; 실행 상태
  - **실행 상태(running)**: CPU를 할당받아 실행 중인 상태
    - 할당된 시간을 모두 사용해서 *타이머 인터럽트*가 발생하면 다시 준비 상태로 변환
  - **대기 상태(blocked)**: 입출력장치의 작업 또는 특정 이벤트를 기다리는 상태.
    - 입출력 작업이 완료되면 다시 준비 상태로 변환
  - **종료 상태(terminated)**: 프로세스가 종료되어 운영체제는 PCB와 프로세스가 사용한 메모리 정리
- 프로세스 계층 구조
  - 부모 프로세스, 자식 프로세스
  - 최초의 프로세스: PID 1을 가지는 최상단 부모 프로세스.
    - 유닉스 init, 리눅스 systemd, macOS launch.
- 프로세스 생성 기법
  - **fork**: 자신의 복사본을 자식 프로세스로 생성
    - 메모리 내용, 열린 파일 목록 등 부모 프로세스의 자원들은 자식 프로세스에 상속됨.
  - **exec**: 자식 프로세스는 자신의 메모리 공간을 다른 프로그램으로 교체

## 10-3 스레드

- **스레드(thread)**
  - 프로세스를 구성하는 실행의 흐름 단위
  - 프로세스 내에 각기 다른 스레드 ID, 프로그램 카운터를 비롯한 레지스터 값, 스택으로 구성
  - 프로세스의 코드/데이터/힙 영역 공유

> 리눅스 운영체제에서는 프로세스와 스레드의 개념을 구분하지 않고 둘다 **태스크(task)** 라 통일한다.

- 멀티프로세스와 멀티스레드
    |멀티프로세스|멀티스레드|
    |---|---|
    |프로세스끼리 자원을 공유하지 않음.|스레드끼리는 같은 프로세스 내의 자원 공유해서 메모리를 더 효율적으로 사용|
    |서로 독립적으로 실행|서로 협력과 통신에 유리|
    |하나의 프로세스에 문제가 생겨도 다른 프로세스에 지장 없음.|하나의 스레드에 문제가 생기면 프로세스 전체에 지장|

> **프로세스 간 통신(IPC)**: 프로세스간 자원을 공유하고 데이터를 주고받는 것.
>
> - 파일을 통한 프로세스 간 통신
> - 공유 메모리
