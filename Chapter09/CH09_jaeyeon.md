# Chapter 09. 운영체제 시작하기

## 09-1. 운영체제를 알아야 하는 이유

### 운영체제란

프로그램 실행에 필요한 요소들을 **시스템 자원** 혹은 **자원**이라고 한다.

앞서 배웠던 부품들은 모두 자원이라고 볼 수 있으며, 모든 프로그램은 실행되기 위해 반드시 자원이 필요하다.

이러한 자원들을 프로그램에 할당하고 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램이 **운영체제**이다.

운영체제도 프로그램이기 때문에 메모리에 적재되어야 하고, 운영체제가 적재 되는 메모리는 특별한 메모리 영역인 **커널 영역**이라는 공간이다.

커널 영역을 제외한 나머지 영역을 **사용자 영역**이라고 한다.

운영체제는 사용자가 실행하려는 응용 프로그램을 메모리의 적절한 공간에 적재하고, 실행되지 않는 프로그램을 메모리에서 삭제하며 메모리 자원을 관리한다.

또한 CPU 자원을 공정하게 프로그램들에 분배하는 역할을 하고, 입출력 장치와 같은 자원을 적절하게 관리한다.

이처럼 운영체제는 응용 프로그램과 하드웨어 사이에서 응용 프로그램에 필요한 자원을 할당하고 응용 프로그램이 올바르게 실행되도록 관리하는 역할을 맡는다.

### 운영체제를 알아야 하는 이유

운영체제를 몰라도 하드웨어를 조작할 수 있지만 운영체제에 대한 이해가 있어야 프로그램이 하드웨어 상에서 어떻게 작동하는지 이해하고, 문제가 발생했을 때 문제 해결의 실마리를 이러한 이해를 통해 찾을 수 있다.

## 09-2. 운영체제의 큰 그림

### 운영체제의 심장, 커널

커널은 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 기능을 담당한다.

GUI와 CLI와 같은 사용자 인터페이스는 커널에 포함되지 않는 서비스이다.

### 이중 모드와 시스템 호출

만약 응용 프로그램이 직접 자원에 접근을 하면 서로 자원을 차지하려고 하거나 응용 프로그램이 잘못 작동하면 컴퓨터 전체에 큰 영향을 끼칠 수가 있다.

이러한 문제를 예방하기 위해 응용 프로그램은 운영체제를 통해서 자원에 접근하도록 한다.

이러한 역할은 이중 모드로 구현되며 이중 모드는 CPU가 명령어를 실행하는 모드를 사용자 모드와 커널 모드로 구분하는 방식이다.

**사용자 모드**는 운영체제 서비스를 제공받을 수 없는 실행 모드이다. 즉 커널 영역의 코드를 실행할 수 없는 모드이며 일반적인 응용 프로그램은 사용자 모드로 실행된다.

**커널 모드**는 운영체제 서비스를 제공받을 수 있는 실행 모드이며, 자원에 접근하는 명령어를 비롯한 모든 명령어를 실행할 수 있다. 

CPU가 어떤 모드로 실행 중인지 확인하기 위해서는 플래그 레지스터 속 슈퍼바이저 플래그를 보면 알 수 있다.

사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공받으려면 운영체제에 요청을 보내 커널 모드로 전환되어야 하며, 운영체제 서비스를 제공받기 위한 요청을 **시스템 호출**(system call)이라고 한다. 

시스템 호출은 일종의 소프트웨어 인터럽트이다.

예를 들어 응용 프로그램이 하드 디스크에 데이터를 저장하려고 한다면, 사용자 모드에서 커널 모드로 전환해야 한다. 이 때 응용 프로그램은 

- 하드 디스크에 데이터를 저장하는 시스템 호출을 발생시켜 커널 모드로 전환하고,
- 운영체제 내의 ‘하드 디스크에 데이터를 저장하는 코드’를 실행하여 하드 디스크에 접근한다.
- 하드 디스크로의 접근이 끝나면 다시 사용자 모드로 복귀한다.

### 운영체제의 핵심 서비스

- 프로세스 관리
    
    프로세스는 실행 중인 프로그램을 뜻한다.
    
    일반적으로 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있기 때문에, CPU는 프로세스들을 번갈아 가며 실행한다. 또한 프로세스들은 상태와 자원이 다양하기 때문에 CPU는 이러한 프로세스들을 일목요연하게 관리하고 실행할 수 있어야 한다.
    
- 자원 접근 및 할당
    - CPU
        
        앞서 CPU는 프로세스들을 번갈아 가며 실행한다고 하였는데, 이러한 경우 프로세스들은 CPU 자원을 공정하게 할당 받아야 하기 때문에 **CPU 스케줄링**을 통해서 공정하게 자원을 할당한다.
        
    - 메모리
        
        프로세스는 크기와 적재되는 주소가 다양하다. 그렇기 때문에 운영체제는 프로세스들 어느 주소에 적재해야 결정해야 한다.
        
    - 입출력 장치
        
        인터럽트 서비스 루틴은 운영체제가 제공하는 기능이기 때문에 커널 영역에 존재한다. 운영체제는 인터럽트 서비스 루틴을 제공하여 입출력 작업을 수행한다.
        
- 파일 시스템 관리
    
    운영체제는 보조기억장치 속 데이터를 파일과 디렉토리로 관리하는데, 이러한 구조를 **파일 시스템**이라고 하며 이 또한 운영체제가 지원하는 핵심 서비스이다.
