## ALU와 제어장치

### ALU

- ALU가 받아들이는 정보
    
    ALU가 계산하기 위해서 피연산자와 수행할 연산이 필요하다.
    
    → ALU는 레지스터를 통해 피연산자를 받아들이고, 제어장치로부터 수행할 연산을 알려주는 제어 신호를 받아들인다. ALU는 레지스터와 제어장치로부터 받아들인 피연산자와 제어 신호로 산술 연산, 논리 연산 등 다양한 연산을 수행한다.
    

- ALU가 내보내는 정보
    
    연산을 수행한 결과인 특정 숫자, 문자, 메모리 주소가 바로 메모리에 저장되지 않고 일시적으로 레지스터에 저장된다.
    또한, ALU는 결과와 함께 연산 결과에 대한 추가적인 정보를 담은 플래그를 사용한다.
    
    - 대표적인 플래그
        
        
        | 플래그 종류 | 의미 | 사용 예시 |
        | --- | --- | --- |
        | 부호 플래그 | 부호를 나타냄 | 1일 경우 : 음수
        0일 경우 : 양수 |
        | 제로 플래그 | 0인지 여부를 나타냄 | 1일 경우 : 0
        0일 경우 : 0이 아님 |
        | 캐리 플래그 | 올림수나 빌림수가 발생했는 지 나타냄 | 1일 경우 : 발생
        0일 경우 : 발생하지 않음 |
        | 오버플로우 플래그 | 오버플로우 발생 여부 | 1일 경우 : 발생
        0일 경우 : 발생하지 않음 |
        | 인터럽트 플래그 | 인터럽트 가능 여부 | 1일 경우 : 인터럽트 가능
        0일 경우 : 인터럽트 불가능 |
        | 슈퍼바이저 플래그 | 커널 모드로 실행 중인지,
        사용자 모드로 실행 중인지 나타냄 | 1일 경우 : 커널 모드
        0일 경우 : 사용자 모드 |
    
    이러한 플래그들은 플래그 레지스터에 저장된다.
    

### 제어장치

제어장치는 제어 신호를 내보내고 명령어를 해석하는 부품

제어 신호는 컴퓨터 부품들을 관리하고 작동시키기 위한 일종의 전기 신호

- 제어 장치가 받아들이는 정보
    1. 클럭 신호
        
        클럭이란 컴퓨터의 모든 부품을 움직일 수 있게 하는 시간 단위
        
        클럭의 주기에 맞춰 한 레지스터에서 다른 레지스터로 데이터가 이동되거나, ALU에서 연산이 수행되거나, CPU가 메모리에 저장된 명령어를 읽어 들인다.
        
    2. 해석해야 될 명령어
        
        명령어 레지스터로부터 해석할 명령어를 받아들이고 해석한 뒤, 제어 신호를 발생시켜 컴퓨터 부품들에 수행해야 할 내용을 알려준다.
        
    3. 플래그 레지스터 속 플래그 값
    4. 시스템 버스에서 제어 버스로 전달된 제어 신호
        
        제어 신호는 CPU뿐만 아니라 입출력장치를 비롯한 CPU 외부 장치도 발생시킬 수 있다.
        
        제어장치는 제어 버스를 통해 외부로부터 전달된 제어 신호를 받아들인다.
        

## 레지스터

많은 CPU가 공통으로 포함하고 있는 여덟개의 레지스터

1. 프로그램 카운터
    
    메모리에서 읽어 들일 명령어의 주소를 저장
    
2. 명령어 레지스터
    
    메모리에서 읽어 들인 명령어를 저장하는 레지스터
    
3. 메모리 주소 레지스터
    
    메모리의 주소를 저장하는 레지스터
    
4. 메모리 버퍼 레지스터
    
    메모리와 주고받을 값을 저장하는 레지스터
    
5. 범용 레지스터
    
    일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
    
    데이터와 주소를 모두 저장할 수 있다.
    
6. 플래그 레지스터
    
    연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터
    
7. 스택 포인터
    
    스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
    
8. 베이스 레지스터
    
    기준 주소
    
- 특정 레지스터를 이용한 주소 지정 방식
    - 스택 주소 지정 방식
        
        스택과 스택 포인터를 이용한 주소 지정 방식
        
        스택은 가장 최근에 저장하는 값부터 꺼낼 수 있는데, 여기서 스택 포인터란 스택의 꼭대기를 가르키는 레지스터. 즉, 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
        
        메모리 안에 스택처럼 사용할 영역이 정해져 있고, 이를 스택 영역이라고 한다.
        
    
    - 변위 주소 지정 방식
        
        명령어는 연산 코드와 오퍼랜드로 이루어져 있고, 오퍼랜드 필드에 메모리 주소가 담길 때도 있다.
        
        변위 주소 지정방식은 오퍼랜드 필드의 값과 특정 레지스터의 값을 더하여 유효 주소를 얻어내는 주소 지정 방식
        
        변위 주소 지정 방식은 오퍼랜드 필드의 주소와 어떤 레지스터를 더하는지에 따라 상대 주소 지정 방식, 베이스 레지스터 주소 지정 방식 등으로 나뉜다.
        
        - 상대 주소 지정 방식
            
            오퍼랜드와 프로그램 카운터 값을 더하여 유효 주소를 얻는 방식
            
            프로그램 카운터 값에 오퍼랜드 숫자 만큼 차이나는 번지로 접근
            
        - 베이스 레지스터 주소 지정 방식
            
            오퍼랜드와 베이스 레지스터의 값을 더하여 유효 주소를 얻는 방식
            
            베이스 레지스터는 ‘기준 주소’, 오퍼랜드는 ‘기준 주소로부터 떨어진 거리’
            
            즉, 베이스 레지스터 주소 지정 방식은 베이스 레지스터 속 기준 주소로부터 얼마나 떨어져 있는 주소에 접근할 것인지를 연산하여 유효 주소를 얻어내는 방식
            

## 명령어 사이클과 인터럽트

### 명령어 사이클

실행하는 프로그램은 수많은 명령어로 이루어져 있고, CPU는 이 명령어들을 하나씩 실행한다.

이때 프로그램 속 각각의 명령어들은 일정한 주기가 반복되며 실행되는데, 이 주기를 명령어 사이클 이라 한다.

1. 인출 사이클
    
    메모리에 있는 명령어를 CPU로 가지고 오는 단계
    
2. 실행 사이클
    
    CPU로 가져온 명령어를 실행하는 단계
    
    제어장치가 명령어 레지스터에 담긴 값을 해석하고, 제어 신호를 발생시키는 단계
    

프로그램의 많은 명령어는 일반적으로 인출과 실행 사이클을 반복하며 실행된다.

1. 간접 사이클
    
    명령어를 인출하여 CPU로 가져왔다 해도 메모리 접근을 한 번 더 해야 될 때 실행되는 단계
    

### 인터럽트

CPU가 수행 중인 작업은 방해를 받아 중단되는데, 작업을 방해하는 신호를 인터럽트라 한다.

인터럽트의 종류에는 크게 동기 인터럽트와 비동기 인터럽트가 있다.

- 동기 인터럽트(예외)
    
    CPU에 의해 방생하는 인터럽트
    
    명령어를 수행하다가 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생하는 인터럽트
    
- 비동기 인터럽트(하드웨어 인터럽트)
    
    주로 입출력 장치에 의해 발생하는 인터럽트
    
    CPU가 프린터와 같은 입출력 장치에 입출력 작업을 부탁했을 때, 입출력 장치가 작업을 끝내면 완료 알림(인터럽트)을 보낸다.
    
    키보드, 마우스와 같은 입출력 장치가 어떠한 입력을 받아들였을 때 이를 처리하기 위해 CPU에 입력 알림(인터럽트)을 보낸다.
    

### 하드웨어 인터럽트

CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 하드웨어 인터럽트를 사용한다.

하드웨어 인터럽트를 사용하면 CPU는 주기적으로 작업 완료 여부를 확일할 필요가 없기 때문에 완료 인터럽트를 받을 때까지 다른 작업을 처리할 수 있다.

### 하드웨어 인터럽트 처리 순서

1. 입출력장치는 CPU에 인터럽트 요청 신호를 보냄
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인
3. CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업
5. CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행
6. 인터럽트 서비스 루틴이 끝나면 백업해 둔 작업을 복구하여 실행

- 인터럽트 요청 신호
CPU의 작업을 방해하는 인터럽트에 대한 요청
- 인터럽트 플래그
CPU가 인터럽트 요청을 수용하기 위해서 플래그 레지스터의 인터럽트 플래그가 활성화되어 있어야 한다.
- 인터럽트 서비스 루틴(인터럽트 핸들러)
어떤 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램 (ex. 마우스가 어떤 인터럽트 요청을 보냈을 때는 어떻게 작동한다, 프로그램에 어떤 문제가 생겼을 때는 어떻게 작동한다)
CPU가 인터럽트 요청을 받아들인 다면, 인터럽트 서비스 루틴(인터럽트 핸들러)이라는 프로그램을 실행한다.
- 인터럽트 벡터
CPU가 인터럽트 서비스 루틴을 구분하기 위한 정보
