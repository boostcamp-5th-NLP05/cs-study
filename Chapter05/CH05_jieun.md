# Chapter 05 CPU 성능 향상 기법

## 05-1 빠른 CPU를 위한 설계 기법

클럭 속도, 멀티코어, 멀티스레드를 활용한다.

### 클럭

- 컴퓨터 부품들은 클럭 신호에 맞춰 작동한다.
- 클럭 속도
  - 단위: 헤르츠(Hz) `eg) 100Hz = 1초에 클럭이 100번 반복`
  - 클럭 속도는 일정하지 않다.
  - **오버클럭킹(overclocking)**: 최대 클럭 속도를 강제로 끌어올려서 고성능을 내는 것
  - 발열 문제 때문에 클럭 속도를 무작정 올릴 수는 없다.

### 코어와 멀티코어

- **코어(core)**: 명령어를 실행하는 부품
- CPU: 코어를 여러 개 포함하는 부품.
- **멀티코어 CPU/멀티코어 프로세서**: 코어를 두 개 이상 포함하는 CPU
- 코어마다 처리할 연산이 균등하게 분배되지 않으면 코어에 비해 연산 속도가 증가하지 않는다.

### 스레드와 멀티스레드

- 스레드(thread): 실행 흐름의 단위
- **하드웨어적 스레드**: 하나의 코어가 동시에 처리하는 명령어 단위
  - `eg) 2코어 4스레드`: CPU는 명령어를 실행하는 부품 2개로 이루어져 있고, 한 번에 네 개 명령어 실행 가능
  - **논리 프로세서**라고 부르기도 함. 프로그램 입장에서는 하드웨어적 스레드 여러 개는 하나의 명령어를 처리하는 CPU가 여러 개 있는 것처럼 보이기 때문.
- **소프트웨어적 스레드**: 하나의 프로그램에서 독집적으로 실행되는 단위
  - 프로그램의 여러 부분을 각각 스레드로 만들어서 동시에 실행
- **멀티스레드 프로세서/멀티스레드 CPU**: 하나의 코어로 여러 명령어를 동시에 처리하는 CPU
  - 하나의 명령어를 수행하기 위해 필요한 '레지스터 세트'가 여러개 있다.
  - **하이퍼스레딩(hyper-threading)**: 인텔의 멀티스레드 기술 명칭  

---

## 05-2 명령어 병렬 처리 기법

CPU를 쉬지 않고 작동시키는 기법에는 명령어 파이프라인, 슈퍼스칼라, 비순차적 명령어 처리가 있다.

### 명령어 파이프라인(Instruction Pipeline)

명령어는 클럭 단위로 다음과 같이 나눠진다. (전공서 마다 다를 수도)

1. 명령어 인출(Instruction Fetch)
2. 명령어 해석(Instruction Decode)
3. 명령어 실행(Execution Instruction)
4. 결과 저장(Write Back)

CPU는 각 단계를 동시에 실행할 수 있다.

- **명령어 파이프라인닝**: 동시에 여러 개의 명령어를 실행하는 것.
  TODO [사진]
- 파이프라인 위험(pipeline hazard): 파이프라인을 사용해도 성능 향상에 실패하는 상황
  - **데이터 위험**
    - *데이터 의존성*에 의해 발생
    - 전 명령어의 연산 결과값이 필요해서 전 명령어를 끝까지 실행해야만 하는 경우.
  - **제어 위험**
    - 분기 등으로 인한 *프로그램 카운터의 갑작스러운 변화*에 의해 발생
    - 다음으로 실행해야 할 명령어가 갑자기 바뀌어서 이미 처리 중이었던 명령어들은 쓸모 없게 되는 경우
    - **분기 예측(branch prediction)**으로 해결 가능
  - **구조적 위험/자원 위험**
    - 서로 다른 명령어가 *동시에 같은 CPU 부품을 사용*해야 할 때 발생

### 슈퍼스칼라(Superscalar)

CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조.\
동일한 명령어 단계를 동시에 실행할 수 있다.

### 비순차적 명령어 처리(OoOE: Out-of-order execution)

명령어 파이프라인이 멈추는 것을 방지하기 위해 명령어의 순서를 바꾸어서 실행한다.

---

## 05-3 CISC와 RISC

### 명령어 집합

- **ISA(Instruction Set Architecture, 명령어 집합 구조)**, 명령어 집합: CPU가 이해할 수 있는 명령어들의 모음
  - ISA에 따라 컴퓨터 구조 및 설계 방식이 다르다

### CISC(Complex Instruction Set Computer)

- **가변 길이 명령어** 활용
- 복잡하고 다양한 수의 명령어가 있어서 적은 수의 명령어로 프로그램 실행 가능
- 한계
  - 명령어 크기와 수행 시간이 각각 다르기 때문에 *명령어 파이프라인 구현이 어려움*
  - 대다수의 복잡한 명령어의 사용 빈도는 낮음

### RISC(Reduced Instruction Set Computer)

- **고정 길이 명령어 활용**: 명령어 길이와 수행 시간이 짧고 규격화 되어 있음
- 자주 쓰이는 기본적인 명령어을 작고 빠르게 만듦
- **load-store 구조**: 메모리에 직접 접근하는 명령어를 load, store 두 개로 제한
  - 레지스터를 적극적으로 사용

### CISC와 RISC 비교

|CISC|RISC|
|---|---|
|복잡하고 다양한 명령어|단순하고 적은 명령어|
|가변 길이 명령어|고정 길이 명령어|
|다양한 주소 지정 방식|적은 주소 지정 방식|
|프로그램을 이루는 명령어의 수가 적음|프로그램을 이루는 명령어의 수가 많음|
|여러 클럭에 걸쳐 명령어 수행|1클럭 내외로 명령어 수행|
|파이프라이닝하기 어려움|파이프라이닝하기 쉬움|
