# Chapter 06: 메모리와 캐시 메모리

## 06-1. RAM의 특징과 종류

### RAM의 특징

RAM은 전원을 끄면 저장된 명령어와 데이터가 모두 날아가는 휘발성 저장 장치이다.

그렇기 때문에 ‘보관할 대상’은 보조기억장치에 저장되고, ‘실행할 대상’이 RAM에 저장된다고 앞서 배웠었다.

### RAM의 용량과 성능

RAM이 작으면 실행할 프로그램을 한 번에 여러개를 저장하지 못하기 때문에, CPU가 프로그램을 실행하고 싶을 때마다 RAM이 보조기억장치에서 프로그램을 불러오는 일이 많아진다.

그렇기 때문에 RAM이 크다면 보조기억장치에 접근하는 일이 줄어들고 많은 프로그램들을 동시에 빠르게 실행하는 것이 유리해진다. 

### RAM의 종류

- **DRAM(Dynamic RAM)**
    
    저장된 데이터가 동적으로 변하는 RAM을 의미한다.
    
    데이터의 소멸을 막기 위해 일정 쥐로 데이터를 재활성화(다시 저장)해야 한다.
    
    소비 전력이 비교적 낮고 저렴하고 집적도가 높아 대용량으로 설계하기 용이하다는 특징이 있다.
    
- **SRAM(Static RAM)**
    
    저장된 데이터가 변하지 않으며, DRAM보다 일반적으로 속도가 더 빠르다.
    
    하지만 집적도가 낮고 소비 전력도 크며 가격도 더 비싸다.
    
    캐시 메모리에 사용되는 RAM이다.
    
- **SDRAM(Synchronous Dynamic RAM)**
    
    클럭 신호와 동기화되어, 클럭 타이밍에 맞춰 CPU와 정보를 주고 받을 수 있는 RAM이다.
    
- **DDR SDRAM(Double Data Rate SDRAM)**
    
    ‘데이터를 주고받는 길의 너비’를 의미하는 대역폭을 넓혀 속도를 빠르게 만든 SDRAM이다.
    
    한 클럭에 CPU와 주고 받을 수 있는 데이터의 양이 많으며, DDR SDRAM은 SDRAM의 2배, DDR2 SDRAM은 SDRAM의 4배, DDR3 SDRAM은 SDRAM보다 8배 많은 대역폭을 가진다.
    

## 06-2. 메모리의 주소 공간

### 물리 주소와 논리 주소

> CPU와 메모리에 저장되어 실행 중인 프로그램은 메모리 몇 번지에 무엇이 저장되어 있는지 다 알지는 못한다.
> 

주소에는 메모리가 사용하는 물리 주소와 CPU와 실행 중인 프로그램이 사용하는 논리 주소가 있다.

같은 프로그램이라도 실행할 때마다 적재되는 물리 주소는 다를 수 있다.

그렇기 때문에 각각의 프로그램은 다른 프로그램들이 메모리의 몇 번지에 저장되어 있는지, 즉 물리 주소가 무엇인지 알 필요가 없다.

각각의 프로그램은 0번지부터 시작하는 자신만의 논리 주소를 가진다.

이는 프로그램마다 독립된 메모리 공간을 가지게끔 하여 다른 프로그램의 실행에 영향을 끼치지 않도록 하는 의도 또한 있다.

CPU는 논리 주소를 사용하고, 메모리는 물리 주소를 갖기 때문에 CPU와 메모리가 소통하려면 중간자가 필요한데 이 역할을 MMU(Memory Management Unit)이 수행한다.

MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환한다. 

또한 특정 프로그램의 시작 주소가 어디에 위치해있는지는 TLB(Translation Lookaside Buffer)라는 장치로 관리 되며 MMU는 TLB를 참조해서 주소를 변환해준다.

### 메모리 보호 기법

앞서 밝힌 내용 중, 한 프로그램이 다른 프로그램에 영향을 끼치지 않도록 독립된 메모리 공간을 가지게끔 한다고 하였다. 

프로그램마다 차지하고 있는 메모리의 크기가 다른데, 이러한 크기를 벗어나는 논리 주소 범위로 명령어를 실행하는 것을 막기 위해 한계 레지스터가 있다.

CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은 지 항상 확인한다.

만약 접근하고자하는 논리 주소가 한계 레지스터보다 높다면 한계 레지스터는 인터럽트를 발생시켜 실행을 중단한다. 

## 06-3. 캐시 메모리

앞선 단원들에서 CPU와 가까울수록 접근 속도가 빠르고 멀어질수록 느려진다고 하였다.

컴퓨터 구조 상으로 봤을 때 CPU와 메모리는 어느 정도 거리가 있기 때문에, 성능 향상을 위해서 레지스터와 메모리 중간에 위치하는 캐시 메모리를 추가하였다.

### 저장 장치 계층 구조

속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비싸다는 특징이 있다.

빠르고 용량이 큰 장치는 비용적으로 효율성이 매우 떨어지기 때문에,

저장 장치를 어떻게 활용하고 운용하는 지에 따라서 저장 장치마다 적절한 성능과 가격을 타협해야 한다.

(단적인 예로 삼성의 DDR4 4GB 메모리와 씨게이트의 1TB 하드디스크의 가격이 비슷하다.)

### 캐시 메모리

캐시 메모리는 CPU와 메모리 사이에 위치하고 레지스터보다 용량이 작으며 메모리보다 빠른 SRAM 기반의 저장 장치이다.

CPU의 연산 속도와 메모리 접근 속도의 차이를 조금이나마 줄이기 위해서 탄생한 장치이다.

캐시 메모리는 대부분 L1, L2, L3 캐시로 구성되며 L1, L2 캐시는 대부분 코어 내부에, L3 캐시는 코어 외부에 위치해 있다.

그렇기 때문에 각각의 코어는 L1, L2 캐시를 가지고 L3 캐시는 공유하는 식으로 설계한다.

참고로, 번호가 클수록 용량이 크고, CPU와 멀고, 가격이 싸다.

### 참조 지역성 원리

캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장한다.

이 때 자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 활용될 경우를 캐시 히트라고 하며, 

예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 캐시 미스라고 한다.

당연히 캐시 히트가 많을수록 성능이 좋아질 것이며 이를 측정할 척도로 캐시 적중률을 사용한다.

> 캐시 적중률 : 캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)
> 

CPU가 사용할 법한 데이터를 예측할 때 참조 지역성의 원리를 주로 사용한다.

참조 지역성의 원리는 아래와 같다

- CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다. → 시간 지역성(Temporal Locality)
- CPU는 접근한 메로이 공간 근처를 접근하려는 경향이 있다. → 공간 지역성(Spatial Locality)
