# Chapter 12 프로세스 동기화

## 12-1 동기화란

- 프로세스 동기화(synchronization): 프로세스들 사이의 수행 시기를 맞추는 것

  > - 실행 순서 제어: 프로세스를 올바른 순서대로 실행하기
  > - 상호 배제(mutual exclusion): 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기

- 실행 순서 제어를 위한 동기화
  - eg) 값을 저장하는 Writer, 값을 읽는 Reader: Writer 실행이 끝나야 Reader가 올바른 값을 읽어들일 수 있다.
- 상호 배제를 위한 동기화
  - eg) 2만 원을 넣는 프로세스 A, 5만 원을 넣는 프로세스 B: A 실행 도중 문맥 교환이 일어나 B가 읽어들인 데이터는 A의 실행을 반영하고 있지 않음.
  - **생산자와 소비자 문제**
    - 생산자는 버퍼에 물건을 넣고, 소비자는 버퍼에서 물건을 사용.
    - '총합' 데이터를 공유함
  - 공유 자원과 임계 구역
    - **공유 자원(shared resource)**: 공동으로 이용하는 변수, 파일, 장치 등
    - **임계 구역(critical section)**: 동시에 실행하면 문제가 발생하는 공유 자원에 접근하는 코드 영역
    - **레이스 컨디션(race condition)**:
      - '총합을 1 증가시킨다'의 고급 언어 한 줄은 저급 언어 여러 줄로 변환되어 실행
      - 실행 중 문맥 교환이 일어나서 문제 발생
    - 임계 구역 문제 해결 원칙 3가지
  
      > 1. 상호 배제(mutual exclusion): 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
      > 2. 진행(progress): 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
      > 3. 유한 대기(bounded waiting): 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다. (무한 대기 주의)

## 동기화 기법

### 뮤텍스 락(Mutext lock: MUTual EXclusion lock)

- 임계 구역에 걸어놓는 자물쇠: 프로세스들이 공유하는 전역 변수 **lock**
- 임계 구역을 잠금: **acquire()**
  - 임계 구역에 들어가기 전 호출
  - 임계 구역이 잠겨 있다면 열릴 때까지 반복적으로 확인, 임계 구역이 열려 있다면 잠금 (`lock=true`)
  - **바쁜 대기(busy wait)**: 반복적으로 조건을 확인하는 대기 방식
- 임계 구역의 잠금 해제: **release()**
  - 임계 구역에서의 작업이 끝나면 호출해서 임계 구역을 엶 (`lock=false`)

### 세마포(semaphore)

- 공유 자원이 여러 개 있는 상황에서 적용 가능
  - binary semaphore(뮤텍스 락과 비슷), **counting semaphore**(현재 다룰 개념)
- 임계 구역에 진입할 수 있는 프로세스 개수 = 사용 가능한 공유 자원 개수: **전역 변수 S**
- 임계 구역에 들어가도 좋은지, 기다려야 할지 알려줌: **wait() / P() / down()**
  - 사용할 수 있는 자원이 없으면 프로세스를 대기 상태로 만들고, 대기 큐에 넣음
- 임계 구역 앞에서 기다리는 프로세스에 가도 좋다는 신호를 줌: **signal() / V() / up()**
  - 대기 큐에서 프로세스를 꺼내고 준비 상태로 변경해서 준비 큐에 넣음
- 세마포를 이용해서 동시 프로세스의 실행 순서 제어
  - 변수 S를 0으로 두고, 먼저 실행할 프로세스 뒤에 signal(), 나중에 실행할 프로세스 앞에 wait()

### 모니터

- 공유 자원과 공유 자원에 접근하기 위한 인터페이스를 묶어서 관리
- 모니터 안에 항상 하나의 프로세스만 들어오도록하여 상호 배제를 위한 동기화 제공
- 모니터에 진입하기 위해 기다리는 큐
- 조건 변수를 이용해서 실행 순서 제어
  - 조건 변수에 대해 wait/signal 수행
  - 모니터에 이미 진입한 프로세스의 실행 조건이 만족될 때까지 기다리는 큐