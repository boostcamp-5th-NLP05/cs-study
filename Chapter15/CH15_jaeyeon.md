# Chapter 15. 파일 시스템

### 파일

파일이란 하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합을 의미한다.

모든 파일에는 이름과 파일을 실행하기 위한 정보, 파일 관련 부가 정보가 있다.

여기서 부가 정도를 **속성** 또는 **메타데이터**라고 한다.

파일은 유형이 다르면 실행 양상도 달라지는데, 이를 위해 파일 이름 뒤에 **확장자**를 붙여 구분한다.

파일을 다루는 모든 작업은 운영체제에 의해 이뤄지기 때문에, 응용프로그램이 파일을 조작하기 위해서는

운영체제로 시스템 호출(ex. 파일 생성, 파일 삭제, 파일 열기 등)을 보내 조작한다.

### 디렉터리

디렉터리는 파일을 관리하기 위한 수단 중 하나이다.

옛날 운영체제에는 하나의 디렉터리만 존재하여 1단계 디렉터리라고 하였고,

현재는 여러 계층을 가진 **트리 구조 디렉터리**를 사용하고 있다.

트리 구조 디렉터리에서 최상위 디렉터리는 **루트 디렉터리**라고 부른다.

- 절대 경로와 상대 경로
    
    절대 경로 : 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
    
    상대 경로 : 현재 디렉터리에서 시작하는 경로
    
- 디렉터리 연산을 위한 시스템 호출
    
    운영체제는 디렉터리 연산을 위한 시스템 호출(ex. 디렉터리 생성, 디렉터리 삭제 등) 또한 제공한다.
    
- 디렉터리 엔트리
    
    디렉터리도 파일이다. 다만 파일은 내부에 해당 파일과 관련된 정보를 담고 있고,
    
    디렉터리는 해당 디렉터리에 담겨 있는 대상과 관련된 정보를 테이블 형태로 가지고 있다.
    

## 15-2. 파일 시스템

### 파티셔닝과 포매팅

새로 만든 보조기억장치를 사용하려면 **파티션을 나누는 작업**과 **포맷 작업**이 필요하다.

**파티셔닝**은 저장 장치의 논리적인 영역을 구획하는 작업을 의미한다.

예시로는 하나의 하드 디스크를 C드라이브, D드라이브로 나눠서 구성하는 것이다.

**포매팅**은 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지 결정하고,

새로운 데이터를 쓸 준비를 하는 작업을 의미한다.

예시로는 윈도우와 맥은 파일 시스템이 다르기 때문에, 한 USB가 윈도우에서만 작동되는

파일 시스템으로 포매팅이 된다면 맥에서는 읽기만 되고 쓰기는 안 되는 경우가 발생한다.

### 파일 할당 방법

운영체제는 파일과 디렉터리를 **블록** 단위로 읽고 쓴다.

하드 디스크의 단위는 섹터이지만, 운영체제에서는 관리가 용이하기 위해 여러 섹터를 묶어 블록 단위로 만들고 관리한다.

(하지만 요새는 섹터 단위를 512KB로 잡고 블록도 512KB로 잡아 1대1로 관리하는 경우가 많은 것 같다.)

파일을 보조기억장치에 할당하는 방법에는 **연속 할당**과 **불연속 할당**이 있다.

그리고 불연속 할당에는 크게 **연결 할당**, **색인 할당**이 있다.

- 연속 할당
    
    보조기억장치 내 연속적인 블록에 파일을 할당하는 방법이다.
    
    연속적으로 저장이 돼있기 때문에, 파일에 접근하려면 파일의 첫 번째 블록 주소와 블록 단위의 길이만 알면 된다.
    
    그렇기 때문에, 연속 할당을 사용하는 파일 시스템에서는 디렉터리 엔트리에 위 정보들을 저장해둔다.
    
    하지만 파일들이 삭제되는 경우 외부 단편화가 일어날 수 있다.
    
    윈도우 7(그리고 그 이하 윈도우 OS)의 경우 연속 할당을 사용했기 때문에 
    
    외부 단편화를 해결하기 위해 디스크 조각 모음이라는 도구를 두기도 했다.
    
- 연결 할당
    
    각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 연결하는 방식이다.
    
    하지만 이 방식의 문제점은 첫 번째 블록부터 하나씩 차례대로 읽어야 한다는 점 때문에
    
    파일 내 임의의 위치에 접근할 때의 속도가 매우 느리다.
    
    또한 하드웨어 고장이나 오류 발생 시 해당 블록 이후의 블록들에 접근할 수 없다는 단점이 있다.
    
- 색인 할당
    
    파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리하는 방식이다.
    
    예를 들어 파일 a의 색인 블록이 4번 블록이고, 파일 a의 데이터가 7번, 13번, 11번에 저장돼있다면
    
    4번 블록 안에는 파일 a의 구성 블록의 주소인 7, 13, 11번이 기록되어 있다.
    
    그렇기 때문에 임의 접근이 느렸던 연결 할당의 문제점을 해결하였고,
    
    색인 블록만 멀쩡하면 중간에 다른 블록이 손상 돼도 이후의 블록들에 접근할 수 있다.
    
    색인 할당을 사용하는 파일 시스템에서는 디렉터리 엔트리에 파일 이름과 **색인 블록 주소**를 명시한다.
    

### 파일 시스템 살펴보기

- FAT 파일 시스템
    
    FAT : File Allocation Table
    
    연결 할당 방식을 사용한다.
    
- 유닉스 파일 시스템
    
    색인 할당 기반의 파일 시스템이다. 
    
    유닉스 파일 시스템에서의 색인 블록은 i-node(index-node)라고 부른다.
    
    파일마다 i-node를 가지며, i-node는 파티션 내 특정 영역에 모여있다.
    
    i-node는 파일 속성 정보와 15개의 블록 주소가 저장될 수 있다.
    
    그러다보니 저장할 수 있는 블록 주소가 한정 되어 아래와 같은 규칙을 정하였다.
    
    1. 블록 주소 중 열두개 에는 직접 블록 주소를 저장한다.
    2. 위 방식으로 충분하지 않다면 열세 번째 주소에 단일 간접 주소 블록을 저장한다.
    3. 위 방식으로도 충분하지 않다면 열네 번째 주소에 이중 간접 블록 주소를 저장한다.
    4. 위 방식으로도 충분하지 않다면 열다섯 번째 주소에 삼중 간접 블록 주소를 저장한다.
