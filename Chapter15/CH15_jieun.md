# Chapter 15 파일 시스템

## 15-1 파일과 디렉터리

### 파일(file)
  
- **파일**: 보조기억장치에 저장된 관련 정보의 집합
- **속성/메타데이터**: 파일 관련 부가 정보
  - 유형, 크기, 보호, 생성 날짜, 마지막 접근 날짜, 마지막 수정 날짜, 생성자, 소유자, 위치
  - **파일 유형**: 운영체제가 인식하는 파일 종류. **확장자**로 명시.
- 파일을 다루는 모든 작업은 시스템 호출에 의해 이루어짐.

### 디렉터리(directory)/폴더(folder)

- 1단계 디렉터리(single-level directory): 모든 파일이 *하나의 디렉터리* 아래에 있는 구조
- 트리 구조 디렉터리: 최상위 디렉터리(**루트 디렉터리**) > 서브 디렉터리 > ... > 파일
- **경로**: 디렉터리를 이용해 파일 위치와 이름을 특정 짓는 정보
  - **절대 경로**: 루트 디렉터리에서 자기 자신까지의 경로
    - eg) `/home/a_dir/b_dir/file.py`
  - **상대 경로**: 현재 디렉터리부터 시작하는 경로
    - eg) `.`, `../hello.py`
- 디렉터리를 다루는 작업은 시스템 호출에 의해 이루어짐.
- *디렉터리도 파일이다*
  - 해당 디렉터리에 담겨 있는 대상에 대한 정보를 표로 저장
  - 디렉터리 엔트리: 대상의 이름, 대상이 저장된 위치 정보 포함

## 15-2 파일 시스템

## 파티셔닝과 포매팅

- 보조기억장치를 처음으로 사용하기 전에 파티셔닝과 포매팅을 해야 함
- **파티셔닝(partitioning)**: 저장 장치의 논리적인 영역을 구획하는 작업. 나누어진 영역 하나를 **파티션**이라 함.
- **포매팅(formatting)**: 파일 시스템을 설정하는 작업
  - cf) 저장 장치를 생성할 때 공장에서 수행되는 **저수준 포매팅**. 본 글에서 설명하는 것은 **논리적 포매팅**

## 파일 할당 방법

- **블록(block)/클러스터**: 운영체제가 파일과 디렉토리를 읽고 쓰는 단위
  - cf) 하드 디스크의 가장 작은 단위는 **섹터**. 섹터는 개수가 너무 많고 크기도 너무 작아서 블록으로 묶어 사용
- **연속 할당(contiguous allocation)**
  - 연속적인 블록에 파일 할당
  - 디렉터리 엔트리: (1) 파일 이름 (2) 첫 번째 블록 주소 (3) 블록 단위의 길이
  - 단점: **외부 단편화** 문제
- **불연속 할당 - 연결 할당(linked allocation)**
  - 각 블록 일부에 다음 블록의 주소를 저장
  - 외부 단편화 문제 해결
  - 디렉터리 엔트리: (1) 파일 이름 (2) 첫 번째 블록 주소 (3) 블록 단위의 길이
  - 단점
    - 첫 번째 블록부터 하나씩 차례대로 읽어야 함. **임의 접근(random access)** 속도 느림
    - 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록 접근 불가능
- **불연속 할당 - 색인 할당(indexed allocation)**
  - 파일의 모든 블록 주소를 **색인 블록**에 모아 관리
  - 디렉터리 엔트리: (1) 파일 이름 (2) 색인 블록 주소

### 파일 시스템

- **FAT 파일 시스템**
  |예약 영역|FAT 영역|루트 디렉터리 영역|데이터 영역|
  |---|---|---|---|
  - USB 메모리, SD 카드 등 저용량 저장 장치에서 사용
  - 연결 할당의 단점 보완
  - **파일 할당 테이블(FAT: File Allocation Table)**: 블록 주소와 다음 블록 주소를 테이블 형태로 관리
  - FAT12, FAT16, FAT32 등에서 숫자는 블록을 표현하는 비트 수
  - FAT를 메모에 캐시하면 임의 접근의 성능이 빨라짐
  - 디렉터리 엔트리: (1) 파일 이름 (2) 첫 번재 블록 주소
    |파일 이름|확장자|속성|예약 영역|생성 시간|마지막 접근 시간|마지막 수정 시간|시작 블록|파일 크기|
    |---|---|---|---|---|---|---|---|---|
    - 속성: 읽기 전용, 숨김 파일, 시스템 파일, 일반 파일, 디렉토리 등 식별하기 위한 항목

- **유닉스 파일 시스템**
  |예약 영역|i-node 영역|데이터 영역|
  |---|---|---|
  - 유닉스 계열 운영체제에서 사용
  - 색인 할당 기반
  - **i-node(index_node)**: 색인 노드
    - 파일 속성 정보 + 15 개의 블록 주소
- i-node 하나만으로 파일의 데이터 블록을 모두 가리킬 수 없다
  - 블록 주소 중 12 개에는 **직접 블록 주소** 저장
    - 파일 데이터가 저장된 블록
  - 13 번째 주소는 **단일 간접 블록**
    - 파일 데이터를 저장한 블록 주소가 저장된 블록
  - 14 번째 주소는 **이중 간접 블록**
    - 단일 간접 블록들의 주소가 저장된 블록
  - 15 번째 주소는 **삼중 간접 블록**
    - 이중 간접 블록들의 주소가 저장된 블록

## 기타

- 윈도우 운영체제의 **NT 파일 시스템(NTFS)**, 리눅스 운영체제의 **ext 파일 시스템**
- **저널링 파일 시스템**
  - **저널링(journaling) 기법**: 작업 로그를 통해 시스템 크래시가 발생했을 때 복구하기 위한 방법
  - 로그 작성 -> 파일 시스템을 변경 작업 수행 -> 로그 삭제
- **마운트**: 한 저장 장치의 파일 시스템에서 다른 저장 장치의 파일 시스템에 접근할 수 있다록 파일 시스템을 편입시키는 작업
