## 파일과 디렉터리

### 파일

파일이란 하드 디스크나 SSD와 같은 보조기억장치에 저장된 관련 정보의 집합

모든 파일에는 이름과 파일을 실행하기 위한 정보, 파일 관련 부가 정보가 있다.

이 부가 정보를 **속성** 또는 **메타데이터**라고 부른다.

- 파일 속성과 유형
대표적인 속성의 종류는 아래와 같다
    
    속성 중 파일 유형은 운영체제가 인식하는 파일 종류를 나타낸다.
    
    파일 유형을 알리기 위해 가장 흔히 사용하는 방식은 확장자를 이용하는 것


### 디렉터리

파일들을 관리하기 위해 디렉터리를 사용할 수 있다. 윈도우 운영체제에서는 디렉터리를 폴더라고 부른다.

옛날 운영체제에서는 모든 파일이 하나의 디렉터리 아래에 있는 1단계 디렉터리 구조였지만,
1단계 디렉터리로는 많은 파일을 관리하기 어렵기 때문에 트리 구조 디렉트리가 생겼다.

트리 구조 디렉터리는 최상위 디렉터리가 있고 그 아래 여러 서브 디렉터리가 있을 수 있다. 

서브 디렉터리는 다른 서브 디렉터리를 가질 수 있따.

최상위 디렉터리는 흔히 루트 디렉터리라고 부르고 슬래시로 표현한다.

- 절대 경로와 상대 경로
    
    같은 디렉터리에는 동일한 이름의 파일이 존재할 수 없지만, 서로 다른 디렉터리에는 동일한 이름의 파일이 존재할 수 있다.
    
    모든 파일은 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로를 가지고 있고, 이러한 경로를 절대 경로라 한다.
    
    상대 경로는 현재 디렉터리부터 시작한느 경로이다.
    

- 디렉터리 엔트리
    
    많은 운영체제에서는 디렉터리를 특별한 형태의 파일로 간주한다.
    
    파일이 내부에 해당 파일과 관련된 정보를 담고 있다면, 디렉터리는 내부에 해당 디렉터리에 담겨있는 대상과 관련된 정보를 담고 있다. 그리고 이 정보는 테이블 형태로 구성된다.
    
    디렉터리 엔트리만 보아도 해당 디렉터리에 무엇이 담겨 있는지, 보조기억장치의 어디에 있는지를 직간접적으로 알 수 있다.
    

## 파일 시스템

파일 시스템은 파일과 디렉터리를 보조기억장치에 일목요연하게 저장하고 접근할 수 있게 하는 운영체제 내부 프로그램이다.

### 파티셔닝과 포매팅

파티셔닝은 저장 장치의 논리적인 영역을 구획하는 작업을 의미한다.

파티셔닝 작업을 통해 나누어진 영역 하나하나를 파티션이라고 한다.

포매팅은 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업을 의미한다.

파일 시스템에는 여러 종류가 있고, 파티션마다 다른 파일 시스템을 설정할 수 있다.

### 파일 할당 방법

운영체제는 파일과 디렉터리를 블록 단위로 읽고 쓴다. 즉, 하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸처 저장된다. 

파일을 보조기억장치에 할당하는 방법에는 크게 두 가지가 있다. 연속 할당과 불연속 할당이다.

불연속 할당에는 크게 연결 할당, 색인 할당이 있다.


- 연속 할당
    
    연속 할당은 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식이다.
    
    연속으로 할당된 파일에 접근하기 위해서는 파일의 첫 번째 블록 주소와 블록 단위의 길이만 알면 된다. → 디렉터리 엔트리에 파일 이름, 첫 번째 블록주소, 길이를 명시한다.
    
    연속할당은 구현이 단순하다는 장점이 있지만, 외부 단편화를 야기한다.
    


- 연결 할당
    
    연결 할당은 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식이다.
    
    즉 파일을 이루는 데이터를 연결 리스트로 관리한다.
    
    디렉터리 엔트리에 파일 이름, 첫 번째 블록주소, 길이를 명시한다.
    
  
    연결 할당은 외부 단편화 문제를 해결하지만 단점이 있다.
    
    - 반드시 첫 번째 블록부터 하나씩 차례대로 읽어야 한다.
        
        파일의 중간 부분부터 접근하고 싶어도 반드시 파일의 첫 번째 블록부터 접근해야 한다.
        
        즉, 임의 접근 속도가 매우 느리다.
        
    - 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근할 수 없다.
        
        하나의 블록 안에 파일 데이터와 다음 블록 주소가 모두 포함되어, 파일을 이루는 블록에 하나라도 문제가 생기면 그 블록 이후의 블록에 접근할 수 없다.
        
- 색인할당
    
    색인 할당은 파일의 모든 블록 주소를 색인 블록이라는 하나의 블록에 모아 관리한다. 
    
    디렉터리 엔트리에 파일 이름과 색인 블록 주소를 명시한다.


### 파일 시스템 살펴보기

대표적인 파일 시스템은 두 가지이다. USB 메모리, SD 카드 등의 저용량 저장 장치에서 사용되는 FAT 파일 시스템, 유닉스 계열 운영체제에서 사용되는 유닉스 파일 시스템이 있다.

- FAT  파일 시스템
    
    연결 할당의 단점을 보완한 파일 시스템이 FAT 파일 시스템이다.
    
    각 블록에 포함된 다음 블록의 주소스들을 한데 모아 테이블 형태로 관리하면 연결 할당의 단점들을 상당 부분 해소할 수 있다. 이러한 테이블을 파일 할당 테이블(FAT)이라 한다.
    
    이렇게 FAT를 이용하는 파일 시스템이 FAT 파일 시스템이다.
    
    하드 디스크의 한 파티션을 FAT 파일 시스템으로 포맷하면 해당 파티션은 아래와 같이 구성된다.
     
    FAT 영역에 FAT가 저장되고, 뒤이어 루트 디렉터리가 저장되는 영역이 있고, 그 뒤에 서브 디렉터리와 파일들을 위한 영역이 있다.
    
    - home/minchul/a.sh 파일을 읽는 과정
    
    1. 3번 블록을 읽어 home 디렉터리 내용을 살펴 본다.
    2. 15번 블록을 읽어 minchul 디렉터리 내용을 살펴 본다.
    3. [a.sh](http://a.sh) 파일의 첫 번째 블록 주소가 9번이라는 것을 확인하고, FAT를 보며 9,8,11,13 순서로 접근한다

- 유닉스 파일 시스템
    
    유닉스 파일 시스템은 색인 할당 기반이다.
    
    유닉스 파일 시스템에서는 색인 블록을 i-node라고 불느다.
    
    i-node에는 파일 속성 정보와 열다섯 개의 블록 주소가 저장될 수 있다.,
     
    유닉스 파일 시스템에는 파일마다 이러한 i-node가 있고, i-node마다 번호가 부여되어 있다.
    
    i-node들은 다음과 같이 파티션 내 특정 영역에 모여 있다.
    
    i-node 영역에 i-node들이 있고, 데이터 영역에 디렉터리와 파일들이 있다.
      
    여기서 i-node의 크기 보다 큰 파일을 가리킬 수 없다는 문제가 있다. 유닉스 파일 시스템은 이런 문제를 아래와 같이 해결한다.
    
    1. 블록 주소 중 열두 개에는 직접 블록 주소를 저장한다.
    2. 1 내용으로 충분하지 않다면 열세 번째 주소에 단일 간접 블록 주소를 저장한다.
        
        단일 간접 블록 주소는 파일 데이터가 저장된 블록이 아닌 파일 데이터를 저장한 블록 주소가 저장된 블록을 의미한다.
        
    3. 2 내용으로 충분하지 않다면 이중 간접 블록 주소를 저장한다.
        
        이중 간접 블록이란 단일 간접 블록들의 주소를 저장하는 블록이다.
        
    4. 3 내용으로 충분하지 않다면 열다섯 번째 주소에 삼중 간접 블록 주소를 저장한다.
        
        삼중 간접 블록 주소는 이중 간접 블록 주소가 저장된 블록이다.
        
        삼중 간접 블록까지 이용하면 웬만한 크기의 파일은 모두 표현할 수 있다.
        
    
    - /home/minchul/a.sh 파일을 읽는 과정
        
        2번 i-node가 루트 디렉터리의 i-node라고 가정한다.
        
        1. 2번 i-node에 접근하여 1번 블록을 읽어 루트 디렉터리의 내용을 알 수 있다.
        2. 3번 i-node에 접근하여 210번 블록을 읽어 home 디렉터리 내용을 알 수 있다.
        3. 8번 i-node에 접근하여 121번 블록을 읽어 minchul 디렉터리의 내용을 알 수 있다.
        4. 9번 i-node에 접근하여 98,12,13 번 블록에 접근하여 a.sh를 읽는다.
    
